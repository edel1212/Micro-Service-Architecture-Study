# ----------------------------------------
# ğŸ›  Deployment: user-deploy
# - user-service ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” Deployment ì •ì˜
# - í™˜ê²½ ë³€ìˆ˜ëŠ” ConfigMapìœ¼ë¡œë¶€í„° ì£¼ì…
# ----------------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-deploy
spec:
  selector:
    matchLabels:
      app: user-app         # ì´ ë ˆì´ë¸”ì„ ê°€ì§„ Podì„ ì„ íƒ
  replicas: 1                # Pod ìˆ˜: 1ê°œ
  template:
    metadata:
      labels:
        app: user-app       # Podì— ë¶€ì—¬ë  ë ˆì´ë¸”
    spec:
      containers:
        - name: user-service
          image: edowon0623/user-service:ssg_v1.1  # ë°°í¬í•  ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€
          imagePullPolicy: Always                  # í•­ìƒ ì´ë¯¸ì§€ë¥¼ pullí•˜ì—¬ ìµœì‹  ìƒíƒœ ìœ ì§€
          ports:
            - containerPort: 60000                 # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
              protocol: TCP
          resources:
            requests:
              cpu: 500m                            # ìµœì†Œ CPU ë¦¬ì†ŒìŠ¤ ìš”ì²­ (0.5 Core)
              memory: 1000Mi                       # ìµœì†Œ ë©”ëª¨ë¦¬ ë¦¬ì†ŒìŠ¤ ìš”ì²­ (1000 MiB)
          env:                                     # í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ConfigMapìœ¼ë¡œë¶€í„° ì£¼ì…)
            - name: GATEWAY_IP
              valueFrom:
                configMapKeyRef:
                  name: msa-k8s-configmap
                  key: gateway_ip
            - name: TOKEN_EXPIRATION_TIME
              valueFrom:
                configMapKeyRef:
                  name: msa-k8s-configmap
                  key: token_expiration_time
            - name: TOKEN_SECRET
              valueFrom:
                configMapKeyRef:
                  name: msa-k8s-configmap
                  key: token_secret
            - name: ORDER-SERVICE-URL
              valueFrom:
                configMapKeyRef:
                  name: msa-k8s-configmap
                  key: order-service-url

---

# ----------------------------------------
# ğŸŒ Service: user-service [ ë„¤íŠ¸ì›Œí¬ë¥¼ ì„¤ì •í•˜ëŠ” ê¸°ëŠ¥ ]
# - user-service Deploymentì— ì™¸ë¶€ ì ‘ê·¼ì„ í—ˆìš©í•˜ê¸° ìœ„í•œ NodePort ì„œë¹„ìŠ¤ ì •ì˜
# - ì™¸ë¶€ì—ì„œ NodeIP:30001ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥
# ----------------------------------------
apiVersion: v1
kind: Service
metadata:
  name: user-service
spec:
  type: NodePort                      # ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ íƒ€ì…
  selector:
    app: user-app                     # í•´ë‹¹ ë ˆì´ë¸”ì„ ê°€ì§„ Podì— ìš”ì²­ ì „ë‹¬
  ports:
    - protocol: TCP
      port: 60000                     # í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ í¬íŠ¸
      targetPort: 60000              # ì»¨í…Œì´ë„ˆì˜ í¬íŠ¸
      nodePort: 30001                # ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë…¸ë“œ í¬íŠ¸ [ í¬íŠ¸í¬ì›Œë”©ê³¼ ê°™ì€ ê°œë… ]